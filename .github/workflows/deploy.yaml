---
name: ci
on:
  push:
    paths:
      - "cook/**"
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    name: Build cook
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout main
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.11.x

      - name: Install dependencies
        run: |
          python -m pip install 'pycook @ git+https://github.com/openpaul/pycook'
          pip install \
            mkdocs-material \
            mkdocs-minify-plugin \
            mkdocs-redirects \
            mkdocs-git-committers-plugin-2 \
            mkdocs-git-revision-date-localized-plugin

      - name: Build Static Page
        run: |
          mkdocs build -c
      - name: Upload to Webspace
        env:
          FTP_USER: ${{ secrets.FTPUSER }}
          FTP_PASSWORD: ${{ secrets.FTPPASSWORD }}
          SERVER: ${{ secrets.SERVER }}
        run: |
          sudo apt install lftp
          lftp -e "mirror -R site/ .; quit" -p 22 -u $FTP_USER,$FTP_PASSWORD sftp://$SERVER
